<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FIT Â· å‡è„‚æˆå°±ç‰ˆ V6.5-Hybrid</title>
    <style>
        :root {
            --primary: #4F46E5; --accent: #10B981; --danger: #EF4444; 
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #1F2937; --text-sub: #6B7280; --radius: 20px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient); color: var(--text-main);
            margin: 0; padding: 20px 15px 100px; min-height: 100vh; box-sizing: border-box;
        }

        .container { max-width: 500px; margin: 0 auto; }
        .card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        /* é¡¶éƒ¨çœ‹æ¿ */
        .dashboard-main { text-align: center; }
        .dash-value { font-size: 3.5rem; font-weight: 800; margin: 5px 0; letter-spacing: -2px; }
        .status-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; background: #EEF2FF; color: var(--primary); font-size: 0.75rem; font-weight: 700; margin-bottom: 10px; border: 1px solid #E0E7FF; }
        .progress-bar-bg { background: #F3F4F6; height: 12px; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.6s; }

        /* æ—¥å†æ ·å¼ */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .weekday { font-size: 0.65rem; color: var(--text-sub); text-align: center; padding-bottom: 5px; }
        .day { aspect-ratio: 1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.75rem; position: relative; background: #fff; border: 1px solid #f3f4f6; }
        .day.other-month { opacity: 0.2; background: #f9fafb; }
        .day.today { border: 2.5px solid var(--primary); font-weight: 900; }
        .day-fire { position: absolute; top: 1px; right: 1px; font-size: 0.6rem; }
        .day-val { font-size: 0.5rem; margin-top: 2px; transform: scale(0.8); color: #666; }

        /* é¥®é£Ÿç®¡ç†å›å½’æ ·å¼ */
        .food-manage-row { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; }
        .btn-manage { padding: 8px; font-size: 0.75rem; background: #fff; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; white-space: nowrap; }
        .food-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f9fafb; border-radius: 10px; margin-bottom: 5px; font-size: 0.9rem; }

        /* å½•å…¥ä¸æŒ‰é’® */
        input, select { width: 100%; padding: 12px; border: 1px solid #E5E7EB; background: #F9FAFB; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
        .input-group { margin-bottom: 12px; display: grid; gap: 10px; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .grid-food-inputs { grid-template-columns: 1.2fr 1fr 1.2fr; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 700; cursor: pointer; }
        .btn-food { background: linear-gradient(135deg, #F59E0B, #D97706); color: white; }
        .btn-sport { background: linear-gradient(135deg, #10B981, #059669); color: white; }
        
        .record-item { padding: 10px 0; border-bottom: 1px solid #F3F4F6; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
        .del-btn { color: #D1D5DB; cursor: pointer; font-size: 1.2rem; margin-left: 10px; }
        .tool-bar { display: flex; gap: 8px; margin-top: 20px; }
        .btn-tool { background: #fff; color: #666; border: 1px solid #ddd; font-size: 0.75rem; padding: 8px; border-radius: 8px; flex: 1; cursor: pointer; }

        /* è¿åŠ¨çƒ­é‡è¾“å…¥æ¡†ç‰¹æœ‰æ ·å¼ */
        .sport-cal-input { border: 2px solid var(--accent) !important; color: var(--accent); font-weight: 800; text-align: center; background: #fff !important; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 20px;">
        <div id="clock" style="font-size: 2.8rem; font-weight: 200;">00:00</div>
        <div id="dateStr" style="color:var(--text-sub);">...</div>
    </header>

    <div class="card">
        <div class="dashboard-main">
            <div id="autoStatus" class="status-tag">åˆ†æä¸­...</div>
            <div id="uiRemain" class="dash-value" style="color:var(--accent)">0</div>
            <div style="font-size:0.9rem; color:var(--text-sub); font-weight:bold;">ä»Šæ—¥åˆ›é€ ç¼ºå£ (kcal)</div>
        </div>
        <div class="progress-bar-bg"><div id="progressBar" class="progress-bar-fill"></div></div>
        <div class="stats-row" style="display:flex; justify-content:space-between; margin-top:12px; font-size:0.85rem; color:var(--text-sub);">
            <span>æ‘„å…¥: <span id="uiEaten">0</span></span>
            <span>ç»´æŒä¸Šé™: <span id="uiGoal">0</span></span>
            <span>è¿åŠ¨èµš: <span id="uiBurned">0</span></span>
        </div>
        <div id="bmrLine" style="text-align:center; margin-top:10px; font-size:0.75rem; color:var(--text-sub); border-top:1px dashed #eee; padding-top:8px;">
            âš ï¸ åŸºç¡€ä»£è°¢åº•çº¿ (BMR): <span id="uiBmr">0</span> kcal
        </div>
    </div>

    <div class="card">
        <div class="card-header"><div class="card-title" style="font-weight:700; margin-bottom:10px;">ğŸ” é¥®é£Ÿè®°å½•</div></div>
        
        <div class="food-manage-row">
            <select id="foodSelect" onchange="updateFoodInput()"></select>
            <button class="btn-manage" id="btnManageToggle" onclick="toggleFoodManager()">ç®¡ç†åˆ—è¡¨</button>
        </div>

        <div id="foodManagerPanel" style="display:none; margin-bottom:15px; max-height: 200px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 12px;">
            <p style="font-size:0.7rem; color:var(--text-sub); margin-top:0;">ç‚¹å‡» Ã— åˆ é™¤å¸¸ç”¨é£Ÿç‰©è®°å½•ï¼š</p>
            <div id="customFoodList"></div>
        </div>

        <div id="customNameInput" class="input-group">
            <input type="text" id="foodNameCustom" placeholder="æ–°é£Ÿç‰©åç§° (å¦‚: å·¨æ— éœ¸)">
        </div>
        
        <div class="input-group grid-food-inputs">
            <div>
                <label style="font-size:0.75rem">æ•°é‡</label>
                <input type="number" id="foodAmount" placeholder="0" oninput="calcFoodPreview()">
            </div>
            <div>
                <label style="font-size:0.75rem">å•ä½</label>
                <select id="foodUnit" onchange="calcFoodPreview()">
                    <option value="g">å…‹(g)</option>
                    <option value="ä¸ª">ä¸ª</option>
                    <option value="ä»½">ä»½</option>
                    <option value="ml">æ¯«å‡(ml)</option>
                    <option value="ç¢—">ç¢—</option>
                    <option value="å—">å—</option>
                </select>
            </div>
            <div>
                <label style="font-size:0.75rem">æ€»çƒ­é‡</label>
                <input type="number" id="foodCal" placeholder="0">
            </div>
        </div>
        <button class="btn btn-food" onclick="addRecord('food')">ç¡®è®¤è®°å½•é¥®é£Ÿ</button>
    </div>

    <div class="card">
        <div style="font-weight:700; margin-bottom:10px;">ğŸƒ è¿åŠ¨è®°å½•</div>
        <select id="sportType" onchange="toggleSportInputs()" style="margin-bottom:10px;">
            <option value="incline">ğŸ§— è·‘æ­¥æœºçˆ¬å¡ (12-4-30)</option>
            <option value="run">ğŸ’¨ è·‘æ­¥ (æ—¶é€Ÿ/æ—¶é•¿)</option>
            <option value="lift">ğŸ‹ï¸ åŠ›é‡è®­ç»ƒ (æ—¶é•¿)</option>
        </select>
        <div id="sportInputs"></div>
        
        <div style="margin:15px 0;">
            <label style="font-size:0.75rem; color:var(--accent); display:block; text-align:center; margin-bottom:5px;">ğŸ”¥ é¢„ä¼°æ¶ˆè€— (å¯æ ¹æ®æ‰‹è¡¨ä¿®æ”¹)</label>
            <input type="number" id="sportFinalCal" class="sport-cal-input" placeholder="0">
        </div>

        <button class="btn btn-sport" onclick="addRecord('sport')">ç¡®è®¤è¿åŠ¨</button>
    </div>

    <div class="card">
        <div class="calendar-header">
            <button class="btn-tool" onclick="changeMonth(-1)">â®</button>
            <div id="calendarTitle" style="font-weight:700;">...</div>
            <button class="btn-tool" onclick="changeMonth(1)">â¯</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div class="card">
        <div style="font-weight:700; margin-bottom:10px;">ğŸ“ ä»Šæ—¥æ˜ç»†</div>
        <ul id="logList" style="padding:0; margin:0; list-style:none;"></ul>
    </div>

    <div class="card">
        <div onclick="toggleSection('settingsPanel')" style="cursor:pointer; text-align:center; color:var(--text-sub); font-size:0.8rem;">âš™ï¸ ä¿®æ”¹ä¸ªäººå‚æ•°</div>
        <div id="settingsPanel" style="display:none; margin-top:15px;">
            <div class="input-group grid-3">
                <input type="number" id="weight" placeholder="kg">
                <input type="number" id="height" placeholder="cm">
                <input type="number" id="age" placeholder="å²">
            </div>
            <select id="gender" style="margin-top:10px;"><option value="male">ç”·</option><option value="female">å¥³</option></select>
            <button class="btn" style="background:var(--primary); color:white; margin-top:10px;" onclick="saveSettings()">ä¿å­˜ä¿®æ”¹</button>
        </div>
    </div>

    <div class="tool-bar">
        <button class="btn-tool" onclick="exportData()">ğŸ’¾ å¯¼å‡ºJSON</button>
        <button class="btn-tool" onclick="importData()">ğŸ“‚ å¯¼å…¥JSON</button>
        <button class="btn-tool" onclick="if(confirm('æ¸…ç©ºæ‰€æœ‰ï¼Ÿ')){localStorage.clear();location.reload();}">ğŸ§¹ é‡ç½®</button>
    </div>
</div>

<script>
    const foodDB_static = [
        {name: "ç±³é¥­", cal: 116, unit: "g"}, {name: "é¸¡è›‹", cal: 75, unit: "ä¸ª"},
        {name: "é¸¡èƒ¸è‚‰", cal: 118, unit: "g"}, {name: "ç‰›è‚‰", cal: 150, unit: "g"},
        {name: "å…¨éº¦é¢åŒ…", cal: 246, unit: "g"}, {name: "é¦™è•‰", cal: 93, unit: "ä¸ª"}
    ];

    const STORAGE_KEY = 'fitApp_master';
    let appData = { 
        user: { w: 95, h: 178, a: 25, g: 'male' }, 
        customFoods: [], 
        logs: [], history: [], currentDate: "", goal: 2400 
    };
    let viewDate = new Date();

    window.onload = function() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) appData = JSON.parse(saved);
        document.getElementById('weight').value = appData.user.w;
        document.getElementById('height').value = appData.user.h;
        document.getElementById('age').value = appData.user.a;
        document.getElementById('gender').value = appData.user.g;
        updateTime(); setInterval(updateTime, 1000);
        checkNewDay(); refreshFoodList(); toggleSportInputs(); renderUI();
    };

    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0');
        document.getElementById('dateStr').innerText = now.toLocaleDateString('zh-CN',{month:'long',day:'numeric',weekday:'short'});
    }

    function getAutoActivityFactor() {
        const today = new Date(); today.setHours(0,0,0,0);
        let activeDays = 0;
        for(let i = 0; i < 7; i++) {
            const target = new Date(today); target.setDate(today.getDate() - i);
            const dStr = target.toDateString();
            const hist = appData.history.find(h => h.date === dStr && h.hasSport);
            const isTodaySport = (dStr === today.toDateString() && appData.logs.some(l => l.type === 'sport'));
            if (hist || isTodaySport) activeDays++;
        }
        const tag = document.getElementById('autoStatus');
        const map = {0:1.2, 1:1.375, 2:1.375, 3:1.55, 4:1.55, 5:1.725, 6:1.725, 7:1.725};
        const labels = {1.2:"ä¹…åæ¨¡å¼", 1.375:"è½»åº¦æ´»è·ƒ", 1.55:"ä¸­åº¦æ´»è·ƒ", 1.725:"æåº¦æ´»è·ƒ"};
        tag.innerText = `${labels[map[activeDays]] || "ä¹…åæ¨¡å¼"} (${activeDays}å¤©/å‘¨)`;
        return map[activeDays];
    }

    function refreshFoodList() {
        const select = document.getElementById('foodSelect');
        select.innerHTML = '';
        select.add(new Option("âœï¸ è¾“å…¥æ–°é£Ÿç‰©...", "custom"));
        appData.customFoods.forEach((f, i) => {
            select.add(new Option(`â­ ${f.name} (${f.cal}k/${f.unit})`, `user_${i}`));
        });
        foodDB_static.forEach((f, i) => {
            select.add(new Option(`${f.name} (${f.cal}k/${f.unit==='g'?'100g':f.unit})`, `static_${i}`));
        });
        const managerList = document.getElementById('customFoodList');
        managerList.innerHTML = appData.customFoods.length === 0 ? '<p style="font-size:0.7rem; color:#ccc;">æš‚æ— å¸¸ç”¨é£Ÿç‰©</p>' : '';
        appData.customFoods.forEach((f, i) => {
            managerList.innerHTML += `<div class="food-list-item"><span>${f.name} (${f.cal}k/${f.unit})</span>
                                     <span class="del-btn" onclick="deleteCustomFood(${i})">Ã—</span></div>`;
        });
        updateFoodInput();
    }

    function updateFoodInput() {
        const val = document.getElementById('foodSelect').value;
        const isCustom = val === 'custom';
        document.getElementById('customNameInput').style.display = isCustom ? 'grid' : 'none';
        const calInput = document.getElementById('foodCal');
        const unitSelect = document.getElementById('foodUnit');
        if (isCustom) { calInput.readOnly = false; calInput.value = ''; }
        else if (val.startsWith('user_')) {
            const f = appData.customFoods[val.split('_')[1]];
            calInput.value = f.cal; unitSelect.value = f.unit; calInput.readOnly = false;
        } else {
            const f = foodDB_static[val.split('_')[1]];
            unitSelect.value = f.unit; calInput.readOnly = true; calcFoodPreview();
        }
    }

    function calcFoodPreview() {
        const val = document.getElementById('foodSelect').value;
        const amount = parseFloat(document.getElementById('foodAmount').value) || 0;
        const unit = document.getElementById('foodUnit').value;
        if (val === 'custom') return;
        let baseCal = val.startsWith('user_') ? appData.customFoods[val.split('_')[1]].cal : foodDB_static[val.split('_')[1]].cal;
        document.getElementById('foodCal').value = Math.round(unit === 'g' ? (baseCal / 100) * amount : baseCal * amount);
    }

    function toggleFoodManager() {
        const p = document.getElementById('foodManagerPanel');
        const btn = document.getElementById('btnManageToggle');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        btn.innerText = p.style.display === 'block' ? 'é€€å‡ºç®¡ç†' : 'ç®¡ç†åˆ—è¡¨';
    }

    function deleteCustomFood(i) {
        if (confirm(`ç¡®å®šåˆ é™¤ "${appData.customFoods[i].name}" å—ï¼Ÿ`)) {
            appData.customFoods.splice(i, 1); saveData(); refreshFoodList();
        }
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        const year = viewDate.getFullYear(), month = viewDate.getMonth();
        document.getElementById('calendarTitle').innerText = `${year}å¹´ ${month + 1}æœˆ`;
        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const prevMonthDays = new Date(year, month, 0).getDate();
        for (let i = firstDay - 1; i >= 0; i--) createDayNode(prevMonthDays - i, true);
        for (let i = 1; i <= daysInMonth; i++) {
            const dStr = new Date(year, month, i).toDateString();
            const hist = appData.history.find(h => h.date === dStr);
            const isToday = dStr === new Date().toDateString();
            let rem = hist ? hist.remain : null;
            let hasS = hist ? hist.hasSport : false;
            if (isToday) {
                let e=0, b=0; appData.logs.forEach(l=>{if(l.type==='food')e+=l.val; else b+=l.val;});
                if(e>0||b>0) { rem = appData.goal - e + b; hasS = hasS || appData.logs.some(l=>l.type==='sport'); }
            }
            createDayNode(i, false, isToday, rem, hasS);
        }
        const remaining = (7 - ((firstDay + daysInMonth) % 7)) % 7;
        for (let i = 1; i <= remaining; i++) createDayNode(i, true);
    }

    function createDayNode(num, isOther, isToday, remain, hasSport) {
        const div = document.createElement('div');
        div.className = `day ${isOther ? 'other-month' : ''} ${isToday ? 'today' : ''}`;
        if (!isOther && remain !== null && remain > 0) div.style.backgroundColor = `rgba(16, 185, 129, ${Math.min(remain / 1200, 0.7) + 0.1})`;
        div.innerHTML = `<span>${num}</span>`;
        if (hasSport) div.innerHTML += `<span class="day-fire">ğŸ”¥</span>`;
        if (!isOther && remain !== null) div.innerHTML += `<span class="day-val">${Math.round(remain)}</span>`;
        document.getElementById('calendarGrid').appendChild(div);
    }

    function addRecord(type) {
        let name, val;
        if (type === 'food') {
            const selectVal = document.getElementById('foodSelect').value;
            val = parseFloat(document.getElementById('foodCal').value);
            const unit = document.getElementById('foodUnit').value;
            if (!val) return alert("è¯·è¾“å…¥çƒ­é‡");
            if (selectVal === 'custom') {
                name = document.getElementById('foodNameCustom').value.trim() || "æœªå‘½åé¥®é£Ÿ";
                if (confirm(`æ˜¯å¦å°† "${name}" (å•ä½:${unit}) æ°¸ä¹…å­˜å…¥ä½ çš„å¸¸ç”¨åˆ—è¡¨ï¼Ÿ`)) {
                    let amt = parseFloat(document.getElementById('foodAmount').value) || 1;
                    let calToSave = (unit === 'g') ? (val / amt * 100) : (val / amt);
                    appData.customFoods.unshift({name, cal: Math.round(calToSave), unit});
                    refreshFoodList();
                }
            } else {
                name = selectVal.startsWith('user_') ? appData.customFoods[selectVal.split('_')[1]].name : foodDB_static[selectVal.split('_')[1]].name;
            }
        } else {
            // è¯»å–æ‰‹åŠ¨ä¿®æ”¹åçš„æœ€ç»ˆçƒ­é‡å€¼
            val = parseFloat(document.getElementById('sportFinalCal').value) || 0;
            name = document.getElementById('sportType').options[document.getElementById('sportType').selectedIndex].text.split(' ')[1];
            if (val <= 0) return alert("çƒ­é‡å¿…é¡»å¤§äº0");
        }
        appData.logs.push({type, name, val}); saveData();
        if(type==='food') { document.getElementById('foodAmount').value = ''; document.getElementById('foodNameCustom').value = ''; }
    }

    function toggleSportInputs() {
        const type = document.getElementById('sportType').value;
        const container = document.getElementById('sportInputs');
        const listener = "oninput='updateSportCalc()'";
        if(type==='incline') container.innerHTML = `<div class="input-group grid-3"><input type="number" id="s_v" value="4" ${listener}><input type="number" id="s_g" value="12" ${listener}><input type="number" id="s_d" value="30" ${listener}></div>`;
        else if(type==='run') container.innerHTML = `<div class="input-group grid-3"><input type="number" id="s_v" value="8" ${listener}><input type="number" id="s_d" value="30" ${listener}><div></div></div>`;
        else container.innerHTML = `<input type="number" id="s_d" value="45" ${listener}>`;
        updateSportCalc();
    }

    function updateSportCalc() {
        const type=document.getElementById('sportType').value, w=appData.user.w;
        let b=0;
        if(type==='incline'){
            const v=document.getElementById('s_v').value||0, g=document.getElementById('s_g').value||0, d=document.getElementById('s_d').value||0;
            b = (((0.1*v*16.66)+(1.8*v*16.66*g/100)+3.5)*w*d)/200;
        } else { b = (type==='run'?8:4) * w * ((document.getElementById('s_d').value||0)/60); }
        // è‡ªåŠ¨å¡«å…¥ç³»ç»Ÿè®¡ç®—å€¼
        document.getElementById('sportFinalCal').value = Math.round(b);
    }

    function renderUI() {
        const factor = getAutoActivityFactor();
        let bmr = (10 * appData.user.w) + (6.25 * appData.user.h) - (5 * appData.user.a) + (appData.user.g === 'male' ? 5 : -161);
        appData.goal = Math.round(bmr * factor);
        document.getElementById('uiBmr').innerText = Math.round(bmr);
        document.getElementById('uiGoal').innerText = appData.goal;
        let eaten=0, burned=0;
        const logList = document.getElementById('logList'); logList.innerHTML = '';
        appData.logs.forEach((l, i) => {
            if(l.type==='food') eaten += l.val; else burned += l.val;
            logList.innerHTML += `<li class="record-item"><span>${l.type==='food'?'ğŸ”':'ğŸƒ'} ${l.name}</span>
                <span><b style="color:${l.type==='food'?'var(--danger)':'var(--accent)'}">${l.type==='food'?'+':'-'}${l.val}</b>
                <span class="del-btn" onclick="deleteLog(${i})">Ã—</span></span></li>`;
        });
        const rem = appData.goal - eaten + burned;
        const uiRem = document.getElementById('uiRemain');
        uiRem.innerText = (rem>0?"+":"")+rem; uiRem.style.color = rem>0?'var(--accent)':'var(--danger)';
        document.getElementById('uiEaten').innerText = eaten;
        document.getElementById('uiBurned').innerText = burned;
        document.getElementById('progressBar').style.width = Math.min((eaten/(appData.goal+burned))*100, 100)+'%';
        renderCalendar();
    }
    function checkNewDay() {
        const today = new Date().toDateString();
        if (appData.currentDate && appData.currentDate !== today) {
            let e=0, b=0; appData.logs.forEach(l=>{if(l.type==='food')e+=l.val; else b+=l.val;});
            if(e>0||b>0) appData.history.unshift({date:appData.currentDate, remain:(appData.goal-e+b), hasSport:appData.logs.some(l=>l.type==='sport')});
            appData.logs = [];
        }
        appData.currentDate = today; saveData();
    }
    function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); renderUI(); }
    function deleteLog(i) { appData.logs.splice(i,1); saveData(); }
    function toggleSection(id) { const el=document.getElementById(id); el.style.display=el.style.display==='block'?'none':'block'; }
    function changeMonth(d) { viewDate.setMonth(viewDate.getMonth()+d); renderCalendar(); }
    function saveSettings() {
        appData.user.w = parseFloat(document.getElementById('weight').value);
        appData.user.h = parseFloat(document.getElementById('height').value);
        appData.user.a = parseFloat(document.getElementById('age').value);
        appData.user.g = document.getElementById('gender').value;
        saveData(); toggleSection('settingsPanel');
    }
    function exportData() { prompt("å¤åˆ¶ä»¥ä¸‹æ•°æ®", JSON.stringify(appData)); }
    function importData() { const d=prompt("ç²˜è´´JSONæ•°æ®"); if(d){ appData=JSON.parse(d); saveData(); location.reload(); } }
</script>
</body>
</html>
