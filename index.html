<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FIT Â· å‡è„‚æˆå°±ç‰ˆ V6.8</title>
    <style>
        :root {
            --primary: #4F46E5; --accent: #10B981; --danger: #EF4444; 
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #1F2937; --text-sub: #6B7280; --radius: 20px;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-gradient); color: var(--text-main); margin: 0; padding: 20px 15px 100px; min-height: 100vh; box-sizing: border-box; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .dashboard-main { text-align: center; }
        .dash-value { font-size: 3.5rem; font-weight: 800; margin: 5px 0; letter-spacing: -2px; }
        .status-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; background: #EEF2FF; color: var(--primary); font-size: 0.75rem; font-weight: 700; margin-bottom: 10px; border: 1px solid #E0E7FF; }
        .progress-bar-bg { background: #F3F4F6; height: 12px; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.6s; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .weekday { font-size: 0.65rem; color: var(--text-sub); text-align: center; padding-bottom: 5px; }
        .day { aspect-ratio: 1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.75rem; position: relative; background: #fff; border: 1px solid #f3f4f6; }
        .day.other-month { opacity: 0.2; background: #f9fafb; }
        .day.today { border: 2.5px solid var(--primary); font-weight: 900; }
        .day-fire { position: absolute; top: 1px; right: 1px; font-size: 0.6rem; }
        .day-val { font-size: 0.5rem; margin-top: 2px; transform: scale(0.8); color: #666; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #E5E7EB; background: #F9FAFB; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
        .input-group { margin-bottom: 12px; display: grid; gap: 10px; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .grid-food-inputs { grid-template-columns: 1.2fr 1fr 1.2fr; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 700; cursor: pointer; }
        .btn-food { background: linear-gradient(135deg, #F59E0B, #D97706); color: white; }
        .btn-sport { background: linear-gradient(135deg, #10B981, #059669); color: white; }
        .record-item { padding: 10px 0; border-bottom: 1px solid #F3F4F6; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
        .del-btn { color: #D1D5DB; cursor: pointer; font-size: 1.2rem; margin-left: 10px; }
        .sport-cal-input { border: 2px solid var(--accent) !important; color: var(--accent); font-weight: 800; text-align: center; background: #fff !important; }
        .food-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f9fafb; border-radius: 10px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 20px;">
        <div id="clock" style="font-size: 2.8rem; font-weight: 200;">00:00</div>
        <div id="dateStr" style="color:var(--text-sub);">...</div>
    </header>

    <div class="card">
        <div class="dashboard-main">
            <div id="activityStatus" class="status-tag">æ‰‹åŠ¨æ¨¡å¼</div>
            <div id="uiRemain" class="dash-value" style="color:var(--accent)">0</div>
            <div style="font-size:0.9rem; color:var(--text-sub); font-weight:bold;">ä»Šæ—¥åˆ›é€ ç¼ºå£ (kcal)</div>
        </div>
        <div class="progress-bar-bg"><div id="progressBar" class="progress-bar-fill"></div></div>
        <div class="stats-row" style="display:flex; justify-content:space-between; margin-top:12px; font-size:0.85rem; color:var(--text-sub);">
            <span>æ‘„å…¥: <span id="uiEaten">0</span></span>
            <span>ç»´æŒä¸Šé™: <span id="uiGoal">0</span></span>
            <span>è¿åŠ¨èµš: <span id="uiBurned">0</span></span>
        </div>
        <div id="bmrLine" style="text-align:center; margin-top:10px; font-size:0.75rem; color:var(--text-sub); border-top:1px dashed #eee; padding-top:8px;">
            âš ï¸ åŸºç¡€ä»£è°¢åº•çº¿ (BMR): <span id="uiBmr">0</span> kcal
        </div>
    </div>

    <div class="card">
        <div style="font-weight:700; margin-bottom:10px;">ğŸ” é¥®é£Ÿè®°å½•</div>
        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <select id="foodSelect" onchange="updateFoodInput()"></select>
            <button style="white-space:nowrap; padding: 0 10px; border-radius:10px; border:1px solid #ddd; background:#fff;" onclick="toggleSection('foodManagerPanel')">ç®¡ç†</button>
        </div>
        <div id="foodManagerPanel" style="display:none; margin-bottom:15px; max-height: 200px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 12px;">
            <div id="customFoodList"></div>
        </div>
        <div id="customNameInput" class="input-group"><input type="text" id="foodNameCustom" placeholder="æ–°é£Ÿç‰©åç§°"></div>
        <div class="input-group grid-food-inputs">
            <div><label style="font-size:0.75rem">æ•°é‡</label><input type="number" id="foodAmount" oninput="calcFoodPreview()"></div>
            <div>
                <label style="font-size:0.75rem">å•ä½</label>
                <select id="foodUnit" onchange="calcFoodPreview()">
                    <option value="g">å…‹(g)</option>
                    <option value="ml">æ¯«å‡(ml)</option>
                    <option value="ä¸ª">ä¸ª</option>
                    <option value="ç¢—">ç¢—</option>
                    <option value="ä»½">ä»½</option>
                </select>
            </div>
            <div><label style="font-size:0.75rem">æ€»çƒ­é‡</label><input type="number" id="foodCal"></div>
        </div>
        <button class="btn btn-food" onclick="addRecord('food')">ç¡®è®¤è®°å½•é¥®é£Ÿ</button>
    </div>

    <div class="card">
        <div style="font-weight:700; margin-bottom:10px;">ğŸƒ è¿åŠ¨è®°å½•</div>
        <select id="sportType" onchange="toggleSportInputs()" style="margin-bottom:10px;">
            <option value="incline">ğŸ§— è·‘æ­¥æœºçˆ¬å¡ (12-4-30)</option>
            <option value="run">ğŸ’¨ è·‘æ­¥ (æ—¶é•¿)</option>
            <option value="lift">ğŸ‹ï¸ åŠ›é‡è®­ç»ƒ (æ—¶é•¿)</option>
            <option value="custom">âœï¸ è‡ªå®šä¹‰/å…¶ä»–è¿åŠ¨</option>
        </select>
        <div id="sportInputs"></div>
        <div id="customSportNameGroup" class="input-group" style="display:none; margin-top:10px;">
            <input type="text" id="sportNameCustom" placeholder="è¯·è¾“å…¥è¿åŠ¨é¡¹ç›®åç§°">
        </div>
        <div style="margin:15px 0;">
            <label style="font-size:0.75rem; color:var(--accent); display:block; text-align:center; margin-bottom:5px;">ğŸ”¥ æ‰‹è¡¨çƒ­é‡æ¶ˆè€— (kcal)</label>
            <input type="number" id="sportFinalCal" class="sport-cal-input">
        </div>
        <button class="btn btn-sport" onclick="addRecord('sport')">ç¡®è®¤è¿åŠ¨</button>
    </div>

    <div class="card">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)" style="border:none;background:none;cursor:pointer;">â®</button>
            <div id="calendarTitle" style="font-weight:700;">...</div>
            <button onclick="changeMonth(1)" style="border:none;background:none;cursor:pointer;">â¯</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div class="card">
        <div style="font-weight:700; margin-bottom:10px;">ğŸ“ ä»Šæ—¥æ˜ç»†</div>
        <ul id="logList" style="padding:0; margin:0; list-style:none;"></ul>
    </div>

    <div class="card">
        <div onclick="toggleSection('settingsPanel')" style="cursor:pointer; text-align:center; color:var(--text-sub); font-size:0.8rem;">âš™ï¸ ä¿®æ”¹ä¸ªäººå‚æ•° & æ´»è·ƒç³»æ•°</div>
        <div id="settingsPanel" style="display:none; margin-top:15px;">
            <div class="input-group grid-3">
                <input type="number" id="weight" placeholder="kg">
                <input type="number" id="height" placeholder="cm">
                <input type="number" id="age" placeholder="å²">
            </div>
            <select id="gender" style="margin-bottom:10px;"><option value="male">ç”·</option><option value="female">å¥³</option></select>
            <label style="font-size:0.75rem; color:var(--primary); font-weight:bold;">ç”Ÿæ´»æ´»è·ƒç³»æ•°:</label>
            <select id="userFactor">
                <option value="1.2">1.2 - å‡æœŸ/å®…å®¶ (æœ€å‡†æ‰‹åŠ¨æ¨¡å¼)</option>
                <option value="1.35">1.35 - åœ¨æ ¡æ´»è·ƒ (æœ€å‡†æ‰‹åŠ¨æ¨¡å¼)</option>
                <option value="1.55">1.55 - æé«˜æ´»åŠ¨é‡</option>
            </select>
            <button class="btn" style="background:var(--primary); color:white; margin-top:15px;" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
        </div>
    </div>

    <div style="display:flex; gap:8px; margin-top:20px;">
        <button class="btn" style="flex:1; background:#fff; color:#666; font-size:0.8rem;" onclick="exportData()">ğŸ’¾ å¯¼å‡º</button>
        <button class="btn" style="flex:1; background:#fff; color:#666; font-size:0.8rem;" onclick="importData()">ğŸ“‚ å¯¼å…¥</button>
        <button class="btn" style="flex:1; background:#fff; color:#666; font-size:0.8rem;" onclick="if(confirm('æ¸…ç©ºï¼Ÿ')){localStorage.clear();location.reload();}">ğŸ§¹ é‡ç½®</button>
    </div>
</div>

<script>
    const foodDB_static = [{name:"ç±³é¥­",cal:116,unit:"g"},{name:"é¸¡è›‹",cal:75,unit:"ä¸ª"},{name:"è›‹ç‚’é¥­",cal:273,unit:"g"},{name:"ç‰›è‚‰",cal:250,unit:"g"},{name:"ç‰›å¥¶",cal:60,unit:"ml"}];
    const STORAGE_KEY = 'fitApp_master';
    let appData = { user: { w: 95, h: 178, a: 22, g: 'male', factor: 1.2 }, customFoods: [], logs: [], history: [], currentDate: "", goal: 2000 };
    let viewDate = new Date();

    window.onload = function() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) appData = JSON.parse(saved);
        document.getElementById('weight').value = appData.user.w;
        document.getElementById('height').value = appData.user.h;
        document.getElementById('age').value = appData.user.a;
        document.getElementById('gender').value = appData.user.g;
        document.getElementById('userFactor').value = appData.user.factor;
        updateTime(); setInterval(updateTime, 1000);
        checkNewDay(); refreshFoodList(); toggleSportInputs(); renderUI();
    };

    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0');
        document.getElementById('dateStr').innerText = now.toLocaleDateString('zh-CN',{month:'long',day:'numeric',weekday:'short'});
    }

    function refreshFoodList() {
        const select = document.getElementById('foodSelect');
        select.innerHTML = '<option value="custom">âœï¸ è¾“å…¥æ–°é£Ÿç‰©...</option>';
        appData.customFoods.forEach((f, i) => {
            const u = (f.unit === 'g' || f.unit === 'ml') ? '100' + f.unit : f.unit;
            select.add(new Option(`â­ ${f.name} (${f.cal}k/${u})`, `user_${i}`));
        });
        foodDB_static.forEach((f, i) => {
            const u = (f.unit === 'g' || f.unit === 'ml') ? '100' + f.unit : f.unit;
            select.add(new Option(`${f.name} (${f.cal}k/${u})`, `static_${i}`));
        });
        const managerList = document.getElementById('customFoodList');
        managerList.innerHTML = '';
        appData.customFoods.forEach((f, i) => {
            managerList.innerHTML += `<div class="food-list-item"><span>${f.name}</span> <span class="del-btn" onclick="deleteCustomFood(${i})">Ã—</span></div>`;
        });
        updateFoodInput();
    }

    function updateFoodInput() {
        const val = document.getElementById('foodSelect').value;
        const isCustom = val === 'custom';
        document.getElementById('customNameInput').style.display = isCustom ? 'grid' : 'none';
        if (!isCustom) {
            const f = val.startsWith('user_') ? appData.customFoods[val.split('_')[1]] : foodDB_static[val.split('_')[1]];
            document.getElementById('foodUnit').value = f.unit;
            calcFoodPreview();
        }
    }

    function calcFoodPreview() {
        const val = document.getElementById('foodSelect').value;
        const amount = parseFloat(document.getElementById('foodAmount').value) || 0;
        if (val === 'custom') return;
        let f = val.startsWith('user_') ? appData.customFoods[val.split('_')[1]] : foodDB_static[val.split('_')[1]];
        let result = (f.unit === 'g' || f.unit === 'ml') ? (f.cal / 100 * amount) : (f.cal * amount);
        document.getElementById('foodCal').value = Math.round(result);
    }

    function toggleSportInputs() {
        const type = document.getElementById('sportType').value;
        const inputArea = document.getElementById('sportInputs');
        const customNameArea = document.getElementById('customSportNameGroup');
        const listener = "oninput='updateSportCalc()'";
        
        if (type === 'custom') {
            inputArea.innerHTML = '';
            customNameArea.style.display = 'grid';
            document.getElementById('sportFinalCal').value = '';
        } else {
            customNameArea.style.display = 'none';
            if(type==='incline') inputArea.innerHTML = `<div class="input-group grid-3"><input type="number" id="s_v" value="4" ${listener}><input type="number" id="s_g" value="12" ${listener}><input type="number" id="s_d" value="30" ${listener}></div>`;
            else inputArea.innerHTML = `<input type="number" id="s_d" value="30" ${listener} placeholder="æ—¶é•¿(åˆ†é’Ÿ)">`;
            updateSportCalc();
        }
    }

    function updateSportCalc() {
        const type=document.getElementById('sportType').value;
        if (type === 'custom') return;
        const w=appData.user.w;
        let b=0, d=parseFloat(document.getElementById('s_d').value)||0;
        if(type==='incline'){
            const v=parseFloat(document.getElementById('s_v').value)||0, g=parseFloat(document.getElementById('s_g').value)||0;
            b = (((0.1*v*16.66)+(1.8*v*16.66*g/100)+3.5)*w*d)/200;
        } else { b = (type==='run'?8:4) * w * (d/60); }
        document.getElementById('sportFinalCal').value = Math.round(b);
    }

    function addRecord(type) {
        let name, val;
        if (type === 'food') {
            const sVal = document.getElementById('foodSelect').value;
            val = parseFloat(document.getElementById('foodCal').value);
            if (!val) return;
            if (sVal === 'custom') {
                name = document.getElementById('foodNameCustom').value.trim() || "æ–°é£Ÿç‰©";
                if (confirm(`ä¿å­˜ä¸ºå¸¸ç”¨ï¼Ÿ`)) {
                    appData.customFoods.unshift({name, cal: val, unit: document.getElementById('foodUnit').value});
                    refreshFoodList();
                }
            } else {
                name = sVal.startsWith('user_') ? appData.customFoods[sVal.split('_')[1]].name : foodDB_static[sVal.split('_')[1]].name;
            }
        } else {
            val = parseFloat(document.getElementById('sportFinalCal').value) || 0;
            if (document.getElementById('sportType').value === 'custom') {
                name = document.getElementById('sportNameCustom').value.trim() || "å…¶ä»–è¿åŠ¨";
            } else {
                name = document.getElementById('sportType').options[document.getElementById('sportType').selectedIndex].text.split(' ')[1];
            }
        }
        appData.logs.push({type, name, val}); saveData();
    }

    function renderUI() {
        const f = parseFloat(appData.user.factor);
        let bmr = (10 * appData.user.w) + (6.25 * appData.user.h) - (5 * appData.user.a) + (appData.user.g === 'male' ? 5 : -161);
        appData.goal = Math.round(bmr * f);
        document.getElementById('activityStatus').innerText = `ç³»æ•°: ${f}`;
        document.getElementById('uiBmr').innerText = Math.round(bmr);
        document.getElementById('uiGoal').innerText = appData.goal;
        let eaten=getLogsSum('food'), burned=getLogsSum('sport');
        const logList = document.getElementById('logList'); logList.innerHTML = '';
        appData.logs.forEach((l, i) => {
            logList.innerHTML += `<li class="record-item"><span>${l.type==='food'?'ğŸ”':'ğŸƒ'} ${l.name}</span>
                <span><b style="color:${l.type==='food'?'var(--danger)':'var(--accent)'}">${l.type==='food'?'+':'-'}${l.val}</b>
                <span class="del-btn" onclick="deleteLog(${i})">Ã—</span></span></li>`;
        });
        const rem = appData.goal - eaten + burned;
        const uiRem = document.getElementById('uiRemain');
        uiRem.innerText = (rem>0?"+":"")+rem; 
        uiRem.style.color = rem>0?'var(--accent)':'var(--danger)';
        document.getElementById('uiEaten').innerText = eaten;
        document.getElementById('uiBurned').innerText = burned;
        document.getElementById('progressBar').style.width = Math.min((eaten/(appData.goal+burned))*100, 100)+'%';
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        const year = viewDate.getFullYear(), month = viewDate.getMonth();
        document.getElementById('calendarTitle').innerText = `${year}å¹´ ${month + 1}æœˆ`;
        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let i = 0; i < firstDay; i++) grid.innerHTML += '<div class="day other-month"></div>';
        for (let i = 1; i <= daysInMonth; i++) {
            const dStr = new Date(year, month, i).toDateString();
            const hist = appData.history.find(h => h.date === dStr);
            const isToday = dStr === new Date().toDateString();
            let rem = null, hasS = false;
            if (hist) { rem = hist.remain; hasS = hist.hasSport; }
            else if (isToday && (getLogsSum('food') > 0 || getLogsSum('sport') > 0)) {
                rem = appData.goal - getLogsSum('food') + getLogsSum('sport');
                hasS = appData.logs.some(l=>l.type==='sport');
            }
            const div = document.createElement('div');
            div.className = `day ${isToday ? 'today' : ''}`;
            if (rem !== null) div.style.backgroundColor = `rgba(16, 185, 129, ${Math.min(Math.abs(rem) / 1200, 0.7) + 0.1})`;
            div.innerHTML = `<span>${i}</span>${hasS?'<span class="day-fire">ğŸ”¥</span>':''}${rem!==null?`<span class="day-val">${Math.round(rem)}</span>`:''}`;
            grid.appendChild(div);
        }
    }

    function checkNewDay() {
        const today = new Date().toDateString();
        if (appData.currentDate && appData.currentDate !== today) {
            let e=getLogsSum('food'), b=getLogsSum('sport');
            if(e>0||b>0) appData.history.unshift({date:appData.currentDate, remain:(appData.goal-e+b), hasSport:appData.logs.some(l=>l.type==='sport')});
            appData.logs = [];
        }
        appData.currentDate = today; saveData();
    }
    function getLogsSum(t) { return appData.logs.filter(l=>l.type===t).reduce((s,l)=>s+l.val,0); }
    function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); renderUI(); }
    function deleteLog(i) { appData.logs.splice(i,1); saveData(); }
    function toggleSection(id) { const el=document.getElementById(id); el.style.display=el.style.display==='block'?'none':'block'; }
    function changeMonth(d) { viewDate.setMonth(viewDate.getMonth()+d); renderCalendar(); }
    function exportData() { prompt("å¤åˆ¶", JSON.stringify(appData)); }
    function importData() { const d=prompt("ç²˜è´´"); if(d){ appData=JSON.parse(d); saveData(); location.reload(); } }
    function deleteCustomFood(i) { appData.customFoods.splice(i,1); saveData(); refreshFoodList(); }
    function saveSettings() {
        appData.user.w = parseFloat(document.getElementById('weight').value);
        appData.user.h = parseFloat(document.getElementById('height').value);
        appData.user.a = parseFloat(document.getElementById('age').value);
        appData.user.g = document.getElementById('gender').value;
        appData.user.factor = document.getElementById('userFactor').value;
        saveData(); toggleSection('settingsPanel');
    }
</script>
</body>
</html>
